#!/bin/bash
#
# source of bad [md5|sha1]sum -> https://www.volexity.com/blog/2022/06/02/zero-day-exploitation-of-atlassian-confluence/
#
# usage: ./check_filesum.sh your_confluence_path
# f.e. ./check_filesum.sh /opt/atlassian/confluence/confluence

badmd5sum=f8df4dd46f02dc86d37d46cf4793e036
badsha1sum=4c02c3a150de6b70d6fca584c29888202cc1deef

currentmd5=$(md5sum $1/noop.jsp | awk '{ print $1 }')
currentsha1=$(sha1sum $1/noop.jsp | awk '{ print $1 }')

if [ "$badmd5sum" = "$currentmd5" ]
then
    echo "you should check your system, your md5 sum matches a bad md5sum"
else
    echo "your md5sum might be good"
fi


if [ "$badsha1sum" = "$currentsha1" ]
then
    echo "you should check your system, your sha1 sum matches a bad sha1sum"
else
    echo "your sha1sum might be good"
fi
